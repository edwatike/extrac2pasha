# Система извлечения ИНН из HTML-страниц

Самообучающаяся система для извлечения ИНН компаний из HTML-страниц с возможностью определения и обхода различных типов защит.

## Описание системы

Система предназначена для автоматического извлечения ИНН компаний из HTML-страниц. Основные возможности:
- Извлечение ИНН из HTML-контента
- Автоматическое определение типа защиты (403, капча, Cloudflare, JS-challenge)
- Самообучение стратегиям обхода защит
- Подробное JSON-логирование всех действий
- Сохранение и повторное использование успешных стратегий

## Структура проекта

- `main.py` - точка входа в приложение
- `extractor.py` - модуль извлечения ИНН из HTML
- `protections.py` - определение типов защит и работа со стратегиями обхода
- `logger.py` - система логирования в JSON-формате
- `strategies.json` - база данных стратегий обхода защит
- `fetcher.py` - модуль для загрузки HTML-страниц
- `config.py` - конфигурация приложения
- `.env` - файл с переменными окружения

## Установка и запуск

1. Создайте виртуальное окружение:
```bash
python -m venv venv
source venv/bin/activate  # для Linux/Mac
```

2. Установите зависимости:
```bash
pip install -r requirements.txt
```

3. Установите системные зависимости для Playwright:
```bash
python -m playwright install
sudo apt-get install -y libgstreamer-plugins-bad1.0-0 libflite1 libavif16 gstreamer1.0-libav
```

4. Запустите приложение:
```bash
python main.py
```

## Добавление HTML для обработки

HTML-страницы для обработки можно добавлять несколькими способами:

1. Прямой ввод HTML в файл:
   - Создайте файл с расширением .html в директории `input/`
   - Система автоматически обработает все файлы с расширением .html

2. Через URL:
   - Добавьте URL в файл `urls.txt`
   - Система автоматически загрузит и обработает страницы

## Логирование и обучение

### Логирование

Все действия системы логируются в JSON-формате в файл `log.txt`. Каждая запись содержит:
- Временную метку
- Тип события
- Результат действия
- Дополнительные параметры

Пример лога:
```json
{"timestamp": "2024-01-20T12:34:56", "event": "extraction_attempt", "url": "example.com", "status": "success", "inn": "7707083893"}
```

### Система обучения

1. При столкновении с защитой система:
   - Определяет тип защиты
   - Проверяет наличие стратегии в `strategies.json`
   - Применяет существующую стратегию или логирует неудачу

2. Добавление новых стратегий:
   - Создайте новую запись в `strategies.json`
   - Формат:
```json
{
    "protection_type": "cloudflare",
    "strategy": {
        "method": "playwright",
        "params": {
            "wait_time": 5,
            "js_enabled": true
        }
    }
}
```

## Мониторинг и отладка

- Все логи доступны в реальном времени в `log.txt`
- Статистика успешности различных стратегий в `stats/`
- Отчеты о неудачных попытках в `errors/`

## Расширение функциональности

1. Добавление новых типов защит:
   - Дополните `protections.py`
   - Добавьте соответствующую стратегию в `strategies.json`

2. Создание новых стратегий обхода:
   - Реализуйте логику в `protections.py`
   - Добавьте конфигурацию в `strategies.json`
